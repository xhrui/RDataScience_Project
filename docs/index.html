<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />


<meta name="author" content="Xiaohan Rui" />


<title>Visualization of air quality in Buffalo and the effect factors</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/simplex.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-1.1/textmate.css" rel="stylesheet" />
<script src="site_libs/highlightjs-1.1/highlight.js"></script>
<link href="site_libs/font-awesome-4.5.0/css/font-awesome.min.css" rel="stylesheet" />

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs && document.readyState && document.readyState === "complete") {
   window.setTimeout(function() {
      hljs.initHighlighting();
   }, 0);
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>

<link rel="stylesheet" href="styles.css" type="text/css" />

</head>

<body>

<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
.tabbed-pane {
  padding-top: 12px;
}
button.code-folding-btn:focus {
  outline: none;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 41px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 46px;
  margin-top: -46px;
}

.section h2 {
  padding-top: 46px;
  margin-top: -46px;
}
.section h3 {
  padding-top: 46px;
  margin-top: -46px;
}
.section h4 {
  padding-top: 46px;
  margin-top: -46px;
}
.section h5 {
  padding-top: 46px;
  margin-top: -46px;
}
.section h6 {
  padding-top: 46px;
  margin-top: -46px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>


<div class="container-fluid main-container">

<!-- tabsets -->
<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});
</script>

<!-- code folding -->




<script>
$(document).ready(function ()  {

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_').toLowerCase();
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}


.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
  padding-left: 25px;
  text-indent: 0;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>

<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row-fluid">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-inverse  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">R Data Science Final Project</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">Home</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/adammwilson/RDataScience">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">



<h1 class="title toc-ignore">Visualization of air quality in Buffalo and the effect factors</h1>
<h4 class="author"><em>Xiaohan Rui</em></h4>

</div>


<div id="introduction" class="section level1">
<h1>Introduction</h1>
<p>Each people are concerned about air quality because we need to breathe all the time. And with the air quality index data, we can know how clean or polluted our outdoor or indoor air is, along with associated health effects that may be of concern. And these AQI data uses different colors to present levels which tell people when to take action to protect their health.</p>
<p>However, many people like vivid images more than cold numbers. Based on this situation, I would like to make our statistic results more understandable and interesting for people to look and read. So calendar heatmap may be a good choice. People can see clearly from the heatmap how many unhealthy air days in the past months or years.</p>
<p>Additionally, it is not enough to just know what is air quality. So learning the possible infuencing factors is also important. I want to use daily temperature and wind data from the GHCND data we used in Geo503 chapter 8 class. With the calendar heatmap, we can add in those possible influential data to find if direct relationships exsist. Also some statistics should be done to proof the relationships. If the results show that low AQI days may be effected by low wind speed and high daily temperature, it would be a powerful reminder to let people make preventive measures in such weather, such as wearing a mask.</p>
</div>
<div id="materials-and-methods" class="section level1">
<h1>Materials and methods</h1>
<p>Data: 1. AQI data is downloaded from EPA AIR data website: (You need to choose the geographic positons and the pollutant, such as PM2.5) Here is the website link: <a href="https://www.epa.gov/outdoor-air-quality-data" class="uri">https://www.epa.gov/outdoor-air-quality-data</a></p>
<ol start="2" style="list-style-type: decimal">
<li>GHCND variables: AWND: Average daily wind speed (meters per second or miles per hour as per user preference); TMAX: Maximum temperature; TMIN: Minimum temperature;</li>
</ol>
<p>Here’s my first code chunk. Load any required packages in a code chunk (you may need to install some packages):</p>
<pre class="r"><code>library(plyr)
library(dplyr)</code></pre>
<pre><code>## 
## Attaching package: &#39;dplyr&#39;</code></pre>
<pre><code>## The following objects are masked from &#39;package:plyr&#39;:
## 
##     arrange, count, desc, failwith, id, mutate, rename, summarise,
##     summarize</code></pre>
<pre><code>## The following objects are masked from &#39;package:stats&#39;:
## 
##     filter, lag</code></pre>
<pre><code>## The following objects are masked from &#39;package:base&#39;:
## 
##     intersect, setdiff, setequal, union</code></pre>
<pre class="r"><code>library(ggplot2)
library(openair)
library(ggplot2)
library(readxl)
library(rnoaa)
library(ggmap)
library(openair)
library(climdex.pcic)</code></pre>
<pre><code>## Loading required package: PCICt</code></pre>
<p>Load the PM2.5 air quality data in Buffalo in 2016:(some functions in the packages can only recognize “date” as the column name so we first need to change the name.)</p>
<pre class="r"><code>mytable=read_excel(&quot;Data/Buffalo_PM2.5_AQI.xlsx&quot;)
names(mytable)[1]&lt;-&quot;date&quot;</code></pre>
<p>According to the method mentioned in reference[1], I set some parameters to make the plots below more easier and understandable to be shown:</p>
<pre class="r"><code>dat=mytable
dat$month&lt;-as.numeric(as.POSIXlt(dat$date)$mon+1)
dat$monthf&lt;-factor(dat$month,levels=as.character(1:12),labels=c(&quot;Jan&quot;,&quot;Feb&quot;,&quot;Mar&quot;,&quot;Apr&quot;,&quot;May&quot;,&quot;Jun&quot;,&quot;Jul&quot;,&quot;Aug&quot;,&quot;Sep&quot;,&quot;Oct&quot;,&quot;Nov&quot;,&quot;Dec&quot;),ordered=TRUE)
dat$weekday&lt;-as.POSIXlt(dat$date)$wday
dat$weekdayf&lt;-factor(dat$weekday,levels=rev(0:6),labels=rev(c(&quot;Sun&quot;,&quot;Mon&quot;,&quot;Tue&quot;,&quot;Wed&quot;,&quot;Thu&quot;,&quot;Fri&quot;,&quot;Sat&quot;)),ordered=TRUE)
dat$week &lt;- as.numeric(format(dat$date,&quot;%W&quot;))
dat&lt;-ddply(dat,.(monthf),transform,monthweek=1+week-min(week))</code></pre>
<p>This can take a few seconds to show the plot about Calendar Heatmap of PM2.5 air quality in Buffalo:(in the plot I filter days which have AQI more then 50, just because in Air Quality Index(AQI) leves, more than 50 but less than 100 means moderate, more than 100 but less than 150 means unhealthy for sensitive groups.)</p>
<pre class="r"><code>ggplot(dat,aes(monthweek,weekdayf,fill=DAILY_AQI_VALUE))+
  
  geom_tile(colour=&#39;white&#39;) +
  
  facet_wrap(~monthf ,nrow=3) +
  
  scale_fill_gradient(space=&quot;Lab&quot;,limits=c(50, max(dat$DAILY_AQI_VALUE)),low=&quot;yellow&quot;, high=&quot;red&quot;) +
  
  labs(title=&quot;Buffalo PM2.5 AQI Calendar Heatmap in 2016&quot;,subtitle=&quot;AQI&gt;50&quot;,x=&quot;Week of Month&quot;,y=&quot;&quot;)</code></pre>
<p><img src="index_files/figure-html/unnamed-chunk-4-1.png" width="672" /></p>
<p>Then turns to influential factors:</p>
<pre class="r"><code>datadir=&quot;data&quot;
st = ghcnd_stations()
st=dplyr::filter(st,element%in%c(&quot;TMAX&quot;,&quot;TMIN&quot;,&quot;AWND&quot;))
coords=as.matrix(geocode(&quot;Buffalo, NY&quot;))</code></pre>
<pre><code>## Information from URL : http://maps.googleapis.com/maps/api/geocode/json?address=Buffalo,%20NY&amp;sensor=false</code></pre>
<pre class="r"><code>dplyr::filter(st,
              grepl(&quot;BUFFALO&quot;,name)&amp;
              between(latitude,coords[2]-1,coords[2]+1) &amp;
              between(longitude,coords[1]-1,coords[1]+1)&amp;
         element==&quot;TMAX&quot;)</code></pre>
<pre><code>## # A tibble: 3 x 11
##            id latitude longitude elevation state       name gsn_flag
##         &lt;chr&gt;    &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt; &lt;chr&gt;      &lt;chr&gt;    &lt;chr&gt;
## 1 USC00301010  42.8833  -78.8833    -999.9    NY    BUFFALO         
## 2 USC00301018  42.9333  -78.9000     177.1    NY BUFFALO #2         
## 3 USW00014733  42.9486  -78.7369     211.2    NY    BUFFALO         
## # ... with 4 more variables: wmo_id &lt;chr&gt;, element &lt;chr&gt;,
## #   first_year &lt;int&gt;, last_year &lt;int&gt;</code></pre>
<pre class="r"><code>d=meteo_tidy_ghcnd(&quot;USW00014733&quot;,
                   var = c(&quot;TMAX&quot;,&quot;TMIN&quot;,&quot;AWND&quot;),
                   keep_flags=T)
head(d)</code></pre>
<pre><code>## # A tibble: 6 x 14
##            id       date  awnd mflag_awnd mflag_tmax mflag_tmin qflag_awnd
##         &lt;chr&gt;     &lt;date&gt; &lt;chr&gt;      &lt;chr&gt;      &lt;chr&gt;      &lt;chr&gt;      &lt;chr&gt;
## 1 USW00014733 1938-05-01  &lt;NA&gt;       &lt;NA&gt;                             &lt;NA&gt;
## 2 USW00014733 1938-05-02  &lt;NA&gt;       &lt;NA&gt;                             &lt;NA&gt;
## 3 USW00014733 1938-05-03  &lt;NA&gt;       &lt;NA&gt;                             &lt;NA&gt;
## 4 USW00014733 1938-05-04  &lt;NA&gt;       &lt;NA&gt;                             &lt;NA&gt;
## 5 USW00014733 1938-05-05  &lt;NA&gt;       &lt;NA&gt;                             &lt;NA&gt;
## 6 USW00014733 1938-05-06  &lt;NA&gt;       &lt;NA&gt;                             &lt;NA&gt;
## # ... with 7 more variables: qflag_tmax &lt;chr&gt;, qflag_tmin &lt;chr&gt;,
## #   sflag_awnd &lt;chr&gt;, sflag_tmax &lt;chr&gt;, sflag_tmin &lt;chr&gt;, tmax &lt;dbl&gt;,
## #   tmin &lt;dbl&gt;</code></pre>
<p>Then convert correct units of temperatures (convert to degrees C)</p>
<pre class="r"><code>d_filtered=d%&gt;%
  mutate(tmax=ifelse(qflag_tmax!=&quot; &quot;|tmax==-9999,NA,tmax/10))%&gt;% 
  mutate(tmin=ifelse(qflag_tmin!=&quot; &quot;|tmin==-9999,NA,tmin/10))%&gt;%  
  mutate(awnd=ifelse(qflag_tmin!=&quot; &quot;|awnd==-9999,NA,awnd))%&gt;%  
  arrange(date)</code></pre>
<p>Then filter data in 2016 to match the 2016’s AQI data in Buffalo:</p>
<pre class="r"><code>d_filtered_2016=filter(d_filtered,date&gt;as.Date(&quot;2016-01-01&quot;)&amp;date&lt;as.Date(&quot;2016-12-31&quot;))

head(d_filtered_2016)</code></pre>
<pre><code>## # A tibble: 6 x 14
##            id       date  awnd mflag_awnd mflag_tmax mflag_tmin qflag_awnd
##         &lt;chr&gt;     &lt;date&gt; &lt;chr&gt;      &lt;chr&gt;      &lt;chr&gt;      &lt;chr&gt;      &lt;chr&gt;
## 1 USW00014733 2016-01-02    67                                            
## 2 USW00014733 2016-01-03    72                                            
## 3 USW00014733 2016-01-04    42                                            
## 4 USW00014733 2016-01-05    30                                            
## 5 USW00014733 2016-01-06    39                                            
## 6 USW00014733 2016-01-07    17                                            
## # ... with 7 more variables: qflag_tmax &lt;chr&gt;, qflag_tmin &lt;chr&gt;,
## #   sflag_awnd &lt;chr&gt;, sflag_tmax &lt;chr&gt;, sflag_tmin &lt;chr&gt;, tmax &lt;dbl&gt;,
## #   tmin &lt;dbl&gt;</code></pre>
<p>Plots the daily average wind speed data:</p>
<pre class="r"><code>calendarPlot(d_filtered_2016, pollutant = &quot;awnd&quot;, year=2016)</code></pre>
<pre><code>## Warning in bind_rows_(x, .id): Unequal factor levels: coercing to character</code></pre>
<pre><code>## Warning in bind_rows_(x, .id): binding character and factor vector,
## coercing into character vector

## Warning in bind_rows_(x, .id): binding character and factor vector,
## coercing into character vector

## Warning in bind_rows_(x, .id): binding character and factor vector,
## coercing into character vector

## Warning in bind_rows_(x, .id): binding character and factor vector,
## coercing into character vector

## Warning in bind_rows_(x, .id): binding character and factor vector,
## coercing into character vector

## Warning in bind_rows_(x, .id): binding character and factor vector,
## coercing into character vector

## Warning in bind_rows_(x, .id): binding character and factor vector,
## coercing into character vector

## Warning in bind_rows_(x, .id): binding character and factor vector,
## coercing into character vector

## Warning in bind_rows_(x, .id): binding character and factor vector,
## coercing into character vector

## Warning in bind_rows_(x, .id): binding character and factor vector,
## coercing into character vector

## Warning in bind_rows_(x, .id): binding character and factor vector,
## coercing into character vector

## Warning in bind_rows_(x, .id): binding character and factor vector,
## coercing into character vector</code></pre>
<p><img src="index_files/figure-html/unnamed-chunk-8-1.png" width="672" /></p>
</div>
<div id="results" class="section level1">
<h1>Results</h1>
<p>Show tables, plots, etc. and describe them.</p>
</div>
<div id="conclusions" class="section level1">
<h1>Conclusions</h1>
<p>What have you learned? Are there any broader implications?</p>
</div>
<div id="references" class="section level1">
<h1>References</h1>
</div>

<!-- give the footer some space -->
<br/>
<br/>

<footer id="site-footer">
  <div id="footer1">
  This website is a project for Adam Wilson's <a href="http://www.adamwilson.us/RDataScience"><i> Spatial Data Science (GEO503) </i></a>Course at the University at Buffalo
  </div>
  <div id="footer2">
  <a rel="license" property="http://creativecommons.org/ns#license"
  href="http://creativecommons.org/licenses/by/4.0/" ><img src="img/cc-by.svg" alt="cc-by"/></a> 
  </div>
</footer>


</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>


</body>
</html>
